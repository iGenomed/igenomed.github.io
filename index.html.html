<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIé˜²ç™Œé£é™©è¯„ä¼° Â· ç”¨æˆ·å‹å¥½ç‰ˆ</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
            color: #333;
            line-height: 1.6;
        }
        .container {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #1e56a0;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
        }
        .question-box {
            margin-bottom: 25px;
            padding: 18px;
            background-color: #f8fbff;
            border-left: 4px solid #4a90e2;
            border-radius: 8px;
        }
        .question-text {
            font-weight: bold;
            margin-bottom: 10px;
            color: #222;
        }
        .hint {
            font-size: 13px;
            color: #777;
            margin-top: 8px;
            font-style: italic;
        }
        .options { margin-top: 12px; }
        .option-item {
            margin: 8px 0;
            display: flex;
            align-items: center;
        }
        input[type="radio"], input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
        input[type="number"] {
            width: 80px;
            padding: 6px;
            margin-left: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .btn-group {
            margin-top: 25px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.2s;
        }
        #nextBtn {
            background-color: #1e56a0;
            color: white;
        }
        #nextBtn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #resetBtn {
            background-color: #6c757d;
            color: white;
        }
        #exportBtn {
            background-color: #28a745;
            color: white;
        }
        .report {
            background-color: #f0fff4;
            border: 1px solid #90ee90;
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .hidden { display: none; }
        .progress-bar {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 6px;
            margin-bottom: 20px;
            height: 12px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #4caf50, #8bc34a);
            border-radius: 6px;
            width: 0%;
            transition: width 0.4s ease;
        }
        @media print {
            body * { visibility: hidden; }
            .report, .report * { visibility: visible; }
            .report {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20px;
                box-sizing: border-box;
                background: white !important;
                box-shadow: none !important;
            }
            .btn-group { display: none !important; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– AIé˜²ç™Œé£é™©è¯„ä¼°</h1>
        <p class="subtitle">æ ¹æ®ã€Šå¥åº·ä½“æ£€æœºæ„é˜²ç™Œä½“æ£€æŒ‡å—2025ç‰ˆã€‹ Â· å…±29é¢˜ Â· çº¦éœ€5åˆ†é’Ÿ</p>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div id="questionArea"></div>
        <div id="reportArea" class="hidden"></div>
    </div>

    <script>
        let answers = {};
        let currentQIndex = 0;

        // ç”¨æˆ·å‹å¥½ç‰ˆé—®é¢˜å®šä¹‰ï¼ˆå«è¯´æ˜ï¼‰
        const allQuestions = [
            {
                id: 'gender',
                text: 'æ‚¨çš„æ€§åˆ«æ˜¯ï¼Ÿ',
                type: 'single',
                options: ['ç”·', 'å¥³'],
                hint: 'è¯·é€‰æ‹©ä¸èº«ä»½è¯ä¸€è‡´çš„æ€§åˆ«'
            },
            {
                id: 'age',
                text: 'æ‚¨ä»Šå¹´å¤šå¤§å¹´çºªï¼Ÿ',
                type: 'single',
                options: ['ä¸åˆ°40å²', '40ï½49å²', '50ï½59å²', '60ï½69å²', '70å²åŠä»¥ä¸Š'],
                hint: 'ç™Œç—‡ç­›æŸ¥å»ºè®®é€šå¸¸ä»40å²èµ·åŠ å¼º'
            },
            {
                id: 'residence',
                text: 'æ‚¨ç›®å‰ä¸»è¦ä½åœ¨å“ªç§åœ°æ–¹ï¼Ÿ',
                type: 'single',
                options: ['å¤§åŸå¸‚ï¼ˆå¦‚åŒ—ä¸Šå¹¿æ·±ï¼‰', 'æ™®é€šåŸå¸‚', 'å¿åŸæˆ–ä¹¡é•‡', 'å†œæ‘'],
                hint: 'ä¸åŒåœ°åŒºé¥®é£Ÿã€ç¯å¢ƒæš´éœ²å·®å¼‚è¾ƒå¤§'
            },
            {
                id: 'smoking_status',
                text: 'æ‚¨å¸çƒŸçš„æƒ…å†µæ˜¯ï¼Ÿ',
                type: 'single',
                options: ['ä»ä¸å¸çƒŸ', 'ä»¥å‰å¸è¿‡ï¼Œä½†å·²æˆ’çƒŸè¶…è¿‡5å¹´', 'æœ€è¿‘5å¹´å†…æˆ’çƒŸ', 'ç°åœ¨è¿˜åœ¨å¸çƒŸ'],
                hint: 'åŒ…æ‹¬ç”µå­çƒŸã€é›ªèŒ„ç­‰ï¼›æ¯å¤©å“ªæ€•åªå¸å‡ å£ä¹Ÿç®—â€œç°åœ¨å¸çƒŸâ€'
            },
            {
                id: 'drinking',
                text: 'æ‚¨å¹³æ—¶å–é…’å—ï¼Ÿ',
                type: 'single',
                options: ['å‡ ä¹ä¸å–', 'å¶å°”å–ï¼ˆå¦‚èšä¼šã€èŠ‚æ—¥ï¼‰', 'ç»å¸¸å–ï¼ˆæ¯å‘¨â‰¥2æ¬¡ï¼‰', 'å‡ ä¹æ¯å¤©å–'],
                hint: 'åŒ…æ‹¬ç™½é…’ã€å•¤é…’ã€çº¢é…’ã€é»„é…’ç­‰'
            },
            {
                id: 'bmi',
                text: 'æ ¹æ®æ‚¨çš„èº«é«˜å’Œä½“é‡ï¼Œæ‚¨è§‰å¾—è‡ªå·±ä½“å‹å¦‚ä½•ï¼Ÿ',
                type: 'single',
                options: ['åç˜¦', 'æ­£å¸¸', 'æœ‰ç‚¹èƒ–', 'æ˜æ˜¾è‚¥èƒ–'],
                hint: 'åç˜¦ï¼šè¡£æœæ€»æ˜¯å®½æ¾ï¼›è‚¥èƒ–ï¼šè‚šå­çªå‡ºã€è£¤å­å˜ç´§ã€çˆ¬æ¥¼å–˜'
            },
            {
                id: 'exercise',
                text: 'æ‚¨æ¯å‘¨ä¼šè¿›è¡Œå¿«èµ°ã€æ…¢è·‘ã€éª‘è½¦ç­‰ä¸­ç­‰å¼ºåº¦è¿åŠ¨å—ï¼Ÿ',
                type: 'single',
                options: ['åŸºæœ¬ä¸åŠ¨', 'æ¯å‘¨å°‘äº2.5å°æ—¶', 'æ¯å‘¨2.5å°æ—¶ä»¥ä¸Šï¼ˆçº¦150åˆ†é’Ÿï¼‰'],
                hint: 'ä¸­ç­‰å¼ºåº¦ï¼šè¿åŠ¨æ—¶å¾®å¾®å‡ºæ±—ã€èƒ½è¯´è¯ä½†ä¸èƒ½å”±æ­Œ'
            },
            {
                id: 'diet',
                text: 'æ‚¨çš„æ—¥å¸¸é¥®é£Ÿä¹ æƒ¯æ›´æ¥è¿‘å“ªä¸€ç§ï¼Ÿï¼ˆå¯å¤šé€‰ï¼‰',
                type: 'multi',
                options: [
                    'å¸¸åƒå’¸èœã€è…Šè‚‰ã€ç†é±¼ç­‰è…Œåˆ¶æˆ–ç†åˆ¶é£Ÿå“',
                    'çº¢è‚‰ï¼ˆçŒªç‰›ç¾Šï¼‰æˆ–åŠ å·¥è‚‰ï¼ˆé¦™è‚ ã€ç«è…¿ï¼‰åƒå¾—æ¯”è¾ƒå¤š',
                    'è”¬èœæ°´æœåƒå¾—æ¯”è¾ƒå°‘',
                    'é¥®é£Ÿæ¯”è¾ƒå‡è¡¡ï¼Œè¤ç´ æ­é…'
                ],
                hint: 'è…Œåˆ¶é£Ÿå“å¯èƒ½å«äºšç¡é…¸ç›ï¼Œä¸èƒƒç™Œé£é™©ç›¸å…³'
            },
            {
                id: 'exposure',
                text: 'è¿‡å»10å¹´ï¼Œæ‚¨æ˜¯å¦é•¿æœŸæ¥è§¦ä»¥ä¸‹ç‰©è´¨ï¼Ÿï¼ˆå¯å¤šé€‰ï¼‰',
                type: 'multi',
                options: [
                    'å†œè¯ã€æ²¹æ¼†ã€åŒ–å­¦æº¶å‰‚ç­‰æœ‰æ¯’åŒ–å­¦å“',
                    'æ”¾å°„çº¿ï¼ˆå¦‚åŒ»ç–—ã€å·¥ä¸šå²—ä½ï¼‰',
                    'ç©ºæ°”æ±¡æŸ“ä¸¥é‡åŒºåŸŸï¼ˆå¦‚å·¥å‚é™„è¿‘ï¼‰',
                    'æ²¡æœ‰ä¸Šè¿°æƒ…å†µ'
                ],
                hint: 'â€œé•¿æœŸâ€æŒ‡æ¯å‘¨æ¥è§¦â‰¥3å¤©ï¼ŒæŒç»­1å¹´ä»¥ä¸Š'
            },
            {
                id: 'infection',
                text: 'æ‚¨æ˜¯å¦è¢«åŒ»ç”Ÿè¯Šæ–­è¿‡ä»¥ä¸‹æ„ŸæŸ“ï¼Ÿï¼ˆå¯å¤šé€‰ï¼‰',
                type: 'multi',
                options: [
                    'ä¹™è‚ç—…æ¯’ï¼ˆHBVï¼‰',
                    'ä¸™è‚ç—…æ¯’ï¼ˆHCVï¼‰',
                    'äººä¹³å¤´ç˜¤ç—…æ¯’ï¼ˆHPVï¼Œå¦‚å®«é¢ˆç—…å˜ï¼‰',
                    'å¹½é—¨èºæ†èŒï¼ˆä¸€ç§èƒƒéƒ¨ç»†èŒï¼‰',
                    'ä»æœªæ„ŸæŸ“è¿‡ä»¥ä¸Šç—…æ¯’/ç»†èŒ'
                ],
                hint: 'å¹½é—¨èºæ†èŒå¯é€šè¿‡å‘¼æ°”è¯•éªŒæˆ–èƒƒé•œæ£€å‡º'
            },
            {
                id: 'family_cancer',
                text: 'æ‚¨çš„çˆ¶æ¯ã€å…„å¼Ÿå§å¦¹æˆ–å­å¥³ä¸­ï¼Œæ˜¯å¦æœ‰äººå¾—è¿‡ä»¥ä¸‹ç™Œç—‡ï¼Ÿï¼ˆå¯å¤šé€‰ï¼‰',
                type: 'multi',
                options: [
                    'ä¹³è…ºç™Œ',
                    'åµå·¢ç™Œ',
                    'ç»“ç›´è‚ ç™Œï¼ˆå¤§è‚ ç™Œï¼‰',
                    'èƒƒç™Œ',
                    'è‚ºç™Œ',
                    'è‚ç™Œ',
                    'å®¶é‡Œæ²¡äººå¾—è¿‡è¿™äº›ç™Œ'
                ],
                hint: 'ç›´ç³»äº²å±æ‚£ç™Œæ˜¯é‡è¦é£é™©ä¿¡å·'
            },
            {
                id: 'personal_history',
                text: 'æ‚¨æœ¬äººæ˜¯å¦æœ‰ä»¥ä¸‹ç—…å²ï¼Ÿï¼ˆå¯å¤šé€‰ï¼‰',
                type: 'multi',
                options: [
                    'æ…¢æ€§èç¼©æ€§èƒƒç‚æˆ–èƒƒæºƒç–¡',
                    'æºƒç–¡æ€§ç»“è‚ ç‚ã€å…‹ç½—æ©ç—…ç­‰è‚ é“ç‚ç—‡',
                    'ä¹³è…ºå¢ç”Ÿã€çº¤ç»´è…ºç˜¤ç­‰è‰¯æ€§ä¹³è…ºç—…',
                    'è‚ºéƒ¨æœ‰ç£¨ç»ç’ƒç»“èŠ‚æˆ–å®æ€§ç»“èŠ‚',
                    'æ²¡æœ‰ä¸Šè¿°æƒ…å†µ'
                ],
                hint: 'æŸäº›è‰¯æ€§ç—…å˜å¯èƒ½å¢åŠ ç™Œå˜é£é™©'
            },

            // === å¨æˆ¿æ²¹çƒŸ ===
            {
                id: 'kitchen_smoke',
                text: 'æ‚¨åœ¨å¨æˆ¿åšé¥­æ—¶ï¼Œæ²¹çƒŸå¤§å—ï¼Ÿ',
                type: 'single',
                options: ['åŸºæœ¬æ— æ²¹çƒŸï¼ˆç”¨æŠ½æ²¹çƒŸæœºä¸”é€šé£å¥½ï¼‰', 'æœ‰ç‚¹æ²¹çƒŸä½†ä¸å¤§', 'æ²¹çƒŸæ¯”è¾ƒå¤§', 'æ²¹çƒŸå¾ˆé‡ï¼Œç»å¸¸å‘›äºº'],
                hint: 'å°¤å…¶å¯¹ä¸å¸çƒŸçš„å¥³æ€§ï¼Œé•¿æœŸæ²¹çƒŸæš´éœ²æ˜¯è‚ºç™Œé£é™©å› ç´ '
            },
            {
                id: 'cook_often',
                text: 'æ‚¨å¹³æ—¶ä¼šè‡ªå·±åšé¥­å—ï¼Ÿ',
                type: 'single',
                options: ['å¾ˆå°‘åšï¼ˆæ¯å‘¨<2æ¬¡ï¼‰', 'ç»å¸¸ä¼šåšï¼ˆæ¯å‘¨â‰¥2æ¬¡ï¼‰'],
                hint: 'åŒ…æ‹¬ç‚’èœã€ç…ç‚¸ç­‰äº§ç”Ÿæ²¹çƒŸçš„çƒ¹é¥ªæ–¹å¼'
            },
            {
                id: 'cook_years',
                text: 'æ‚¨ç´¯è®¡åšé¥­å¤šå°‘å¹´äº†ï¼Ÿ',
                type: 'number',
                condition: () => answers.cook_often === 'ç»å¸¸ä¼šåšï¼ˆæ¯å‘¨â‰¥2æ¬¡ï¼‰',
                hint: 'ä¾‹å¦‚ï¼šä»30å²åšåˆ°60å²ï¼Œå°±æ˜¯30å¹´'
            },
            {
                id: 'cook_weekly',
                text: 'æœ€è¿‘ä¸€å¹´ï¼Œå¹³å‡æ¯å‘¨åšé¥­å‡ æ¬¡ï¼Ÿ',
                type: 'number',
                condition: () => answers.cook_often === 'ç»å¸¸ä¼šåšï¼ˆæ¯å‘¨â‰¥2æ¬¡ï¼‰',
                hint: 'åªéœ€å¡«å†™æ•°å­—ï¼Œå¦‚â€œ5â€'
            },

            // === å¥³æ€§ä¸“å±é—®é¢˜ ===
            {
                id: 'menarche_age',
                text: 'æ‚¨ç¬¬ä¸€æ¬¡æ¥æœˆç»æ˜¯å‡ å²ï¼Ÿ',
                type: 'number',
                condition: () => answers.gender === 'å¥³',
                hint: 'ä¸€èˆ¬åœ¨10ï½16å²ä¹‹é—´'
            },
            {
                id: 'menstrual_cycle',
                text: 'æ‚¨æœˆç»å‘¨æœŸä¸€èˆ¬æ˜¯å¤šå°‘å¤©ï¼Ÿ',
                type: 'number',
                condition: () => answers.gender === 'å¥³' && answers.menopause !== 'å·²ç»åœç»',
                hint: 'ä»è¿™æ¬¡æœˆç»ç¬¬ä¸€å¤©åˆ°ä¸‹æ¬¡æœˆç»ç¬¬ä¸€å¤©ï¼Œé€šå¸¸21ï½35å¤©'
            },
            {
                id: 'menopause',
                text: 'æ‚¨ç°åœ¨æœˆç»è¿˜æ­£å¸¸å—ï¼Ÿ',
                type: 'single',
                options: ['è¿˜åœ¨æ¥æœˆç»', 'å·²ç»åœç»ï¼ˆè¶…è¿‡1å¹´æ²¡æ¥ï¼‰'],
                condition: () => answers.gender === 'å¥³',
                hint: 'è‡ªç„¶ç»ç»é€šå¸¸åœ¨45ï½55å²'
            },
            {
                id: 'menopause_age',
                text: 'æ‚¨åœç»æ—¶æ˜¯å‡ å²ï¼Ÿ',
                type: 'number',
                condition: () => answers.gender === 'å¥³' && answers.menopause === 'å·²ç»åœç»',
                hint: 'è‹¥å› æ‰‹æœ¯åˆ‡é™¤å­å®«ï¼Œè¯·å¡«æ‰‹æœ¯å¹´é¾„'
            },
            {
                id: 'live_birth',
                text: 'æ‚¨æ˜¯å¦ç”Ÿè¿‡å­©å­ï¼ˆåŒ…æ‹¬é¡ºäº§æˆ–å‰–å®«äº§ï¼‰ï¼Ÿ',
                type: 'single',
                options: ['æ²¡æœ‰ç”Ÿè¿‡', 'ç”Ÿè¿‡'],
                condition: () => answers.gender === 'å¥³',
                hint: 'åªè¦å­©å­å‡ºç”Ÿæ—¶æ˜¯æ´»çš„å°±ç®—'
            },
            {
                id: 'first_birth_age',
                text: 'æ‚¨ç¬¬ä¸€æ¬¡ç”Ÿå­©å­æ˜¯å‡ å²ï¼Ÿ',
                type: 'number',
                condition: () => answers.gender === 'å¥³' && answers.live_birth === 'ç”Ÿè¿‡',
                hint: 'è‹¥å¤šæ¬¡ç”Ÿè‚²ï¼Œè¯·å¡«ç¬¬ä¸€æ¬¡çš„å¹´é¾„'
            },
            {
                id: 'breastfeed',
                text: 'æ‚¨ç”Ÿå®Œå­©å­åæ˜¯å¦æ¯ä¹³å–‚å…»è¿‡ï¼Ÿ',
                type: 'single',
                options: ['æ²¡æœ‰å“ºä¹³', 'å“ºä¹³è¿‡'],
                condition: () => answers.gender === 'å¥³',
                hint: 'å“ªæ€•åªå–‚è¿‡å‡ å¤©ä¹Ÿç®—'
            },
            {
                id: 'breastfeed_months',
                text: 'æ‰€æœ‰å­©å­åŠ èµ·æ¥ï¼Œæ‚¨æ€»å…±æ¯ä¹³å–‚å…»äº†å‡ ä¸ªæœˆï¼Ÿ',
                type: 'number',
                condition: () => answers.gender === 'å¥³' && answers.breastfeed === 'å“ºä¹³è¿‡',
                hint: 'ä¾‹å¦‚ï¼šä¸¤ä¸ªå­©å­å„å–‚6ä¸ªæœˆï¼Œå…±12ä¸ªæœˆ'
            },
            {
                id: 'miscarriage',
                text: 'æ‚¨æ˜¯å¦æœ‰è¿‡è‡ªç„¶æµäº§æˆ–äººå·¥æµäº§ï¼Ÿ',
                type: 'single',
                options: ['æ²¡æœ‰', 'æœ‰è¿‡'],
                condition: () => answers.gender === 'å¥³',
                hint: 'åŒ…æ‹¬æ€€å­•æ—©æœŸèƒåœã€è¯æµã€äººæµç­‰'
            },
            {
                id: 'miscarriage_count',
                text: 'æ€»å…±å‘ç”Ÿè¿‡å‡ æ¬¡æµäº§ï¼Ÿ',
                type: 'number',
                condition: () => answers.gender === 'å¥³' && answers.miscarriage === 'æœ‰è¿‡',
                hint: 'è¯·å¡«å†™æ€»æ¬¡æ•°'
            },
            {
                id: 'hrt_use',
                text: 'åœç»åï¼Œæ‚¨æ˜¯å¦ä½¿ç”¨è¿‡é›Œæ¿€ç´ ç±»è¯ç‰©ï¼ˆå¦‚æ›´å¹´æœŸæ¿€ç´ æ²»ç–—ï¼‰ï¼Ÿ',
                type: 'single',
                options: ['æ²¡æœ‰ç”¨è¿‡', 'ç”¨è¿‡'],
                condition: () => answers.gender === 'å¥³' && answers.menopause === 'å·²ç»åœç»',
                hint: 'å¸¸è§äºç¼“è§£æ½®çƒ­ã€ç›—æ±—ç­‰ç—‡çŠ¶'
            },
            {
                id: 'hrt_type',
                text: 'æ‚¨ç”¨çš„æ˜¯å“ªç§ç±»å‹ï¼Ÿ',
                type: 'single',
                options: ['åªç”¨é›Œæ¿€ç´ ', 'é›Œæ¿€ç´ +å­•æ¿€ç´ ä¸€èµ·ç”¨', 'ä¸å¤ªæ¸…æ¥š'],
                condition: () => answers.hrt_use === 'ç”¨è¿‡',
                hint: 'å•ç”¨é›Œæ¿€ç´ å¯èƒ½å¢åŠ å­å®«å†…è†œç™Œé£é™©'
            },
            {
                id: 'hrt_years',
                text: 'æ€»å…±ç”¨äº†å¤šå°‘å¹´ï¼Ÿ',
                type: 'number',
                condition: () => answers.hrt_use === 'ç”¨è¿‡',
                hint: 'ä¾‹å¦‚ï¼šç”¨äº†3å¹´å°±åœäº†ï¼Œå¡«â€œ3â€'
            }
        ];

        let visibleQuestions = [];

        function getVisibleQuestions() {
            return allQuestions.filter(q => !q.condition || q.condition());
        }

        function resetAssessment() {
            if (currentQIndex > 0) {
                if (!confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹å—ï¼Ÿå½“å‰è¿›åº¦å°†ä¸¢å¤±ã€‚')) return;
            }
            answers = {};
            currentQIndex = 0;
            document.getElementById('reportArea').classList.add('hidden');
            renderQuestion();
        }

        function updateVisibleQuestions() {
            visibleQuestions = getVisibleQuestions();
        }

        function renderQuestion() {
            updateVisibleQuestions();
            if (currentQIndex >= visibleQuestions.length) {
                generateReport();
                return;
            }

            const q = visibleQuestions[currentQIndex];
            let html = `<div class="question-box">
                <div class="question-text">ç¬¬${currentQIndex + 1}é¢˜ï¼š${q.text}</div>`;

            if (q.hint) {
                html += `<div class="hint">${q.hint}</div>`;
            }

            html += `<div class="options">`;

            if (q.type === 'single') {
                q.options.forEach((opt, i) => {
                    const checked = answers[q.id] === opt ? 'checked' : '';
                    html += `<div class="option-item">
                        <input type="radio" name="${q.id}" value="${opt}" id="${q.id}_${i}" ${checked}>
                        <label for="${q.id}_${i}">${opt}</label>
                    </div>`;
                });
            } else if (q.type === 'multi') {
                q.options.forEach((opt, i) => {
                    const checked = Array.isArray(answers[q.id]) && answers[q.id].includes(opt) ? 'checked' : '';
                    html += `<div class="option-item">
                        <input type="checkbox" name="${q.id}" value="${opt}" id="${q.id}_${i}" ${checked}>
                        <label for="${q.id}_${i}">${opt}</label>
                    </div>`;
                });
            } else if (q.type === 'number') {
                const value = answers[q.id] || '';
                html += `<input type="number" id="${q.id}_input" value="${value}" min="0" placeholder="è¯·è¾“å…¥æ•°å­—">`;
            }

            html += `</div></div>`;
            html += `<div class="btn-group">
                <button id="nextBtn" onclick="goNext()" disabled>ä¸‹ä¸€æ­¥</button>
                <button id="resetBtn" onclick="resetAssessment()">ğŸ”„ é‡æ–°å¼€å§‹</button>
            </div>`;
            document.getElementById('questionArea').innerHTML = html;

            // ç»‘å®šäº‹ä»¶
            if (q.type === 'single') {
                document.querySelectorAll(`input[name="${q.id}"]`).forEach(r => {
                    r.addEventListener('change', () => enableNext());
                });
            } else if (q.type === 'multi') {
                const cbs = document.querySelectorAll(`input[name="${q.id}"]`);
                cbs.forEach(cb => {
                    cb.addEventListener('change', () => {
                        enableNext(cbs);
                    });
                });
            } else if (q.type === 'number') {
                const inputEl = document.getElementById(`${q.id}_input`);
                if (inputEl) {
                    inputEl.addEventListener('input', enableNext);
                }
            }

            updateProgress();
        }

        function enableNext(checkboxes) {
            const q = visibleQuestions[currentQIndex];
            let hasAnswer = false;

            if (q.type === 'single') {
                hasAnswer = document.querySelector(`input[name="${q.id}"]:checked`) !== null;
            } else if (q.type === 'multi') {
                hasAnswer = checkboxes ? Array.from(checkboxes).some(c => c.checked) : true;
            } else if (q.type === 'number') {
                const val = document.getElementById(`${q.id}_input`)?.value;
                hasAnswer = val !== '' && !isNaN(val) && parseInt(val) >= 0;
            }

            document.getElementById('nextBtn').disabled = !hasAnswer;
        }

        function goNext() {
            const q = visibleQuestions[currentQIndex];
            if (q.type === 'single') {
                const selected = document.querySelector(`input[name="${q.id}"]:checked`);
                if (selected) answers[q.id] = selected.value;
            } else if (q.type === 'multi') {
                const checked = document.querySelectorAll(`input[name="${q.id}"]:checked`);
                answers[q.id] = Array.from(checked).map(c => c.value);
            } else if (q.type === 'number') {
                const val = document.getElementById(`${q.id}_input`).value;
                answers[q.id] = parseInt(val) || 0;
            }

            currentQIndex++;
            renderQuestion();
        }

        function updateProgress() {
            const total = visibleQuestions.length;
            const percent = total > 0 ? ((currentQIndex) / total) * 100 : 0;
            document.getElementById('progressFill').style.width = `${percent}%`;
        }

        function exportToPDF() {
            alert("å³å°†æ‰“å¼€æ‰“å°çª—å£ã€‚\n\nè¯·åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­é€‰æ‹©ã€å¦å­˜ä¸º PDFã€‘å³å¯ä¿å­˜æŠ¥å‘Šåˆ°ç”µè„‘ã€‚");
            window.print();
        }

        function generateReport() {
            document.getElementById('questionArea').classList.add('hidden');
            let reportHTML = `
                <div class="report">
                    <h2 style="color:#1e56a0; text-align:center;">ğŸ“Š æ‚¨çš„AIç™Œç—‡é£é™©è¯„ä¼°æŠ¥å‘Š</h2>
                    <p><strong>åŸºæœ¬ä¿¡æ¯ï¼š</strong>æ€§åˆ«ï¼š${answers.gender}ï¼Œå¹´é¾„ï¼š${answers.age}</p>`;

            let risks = [];
            let recs = [];

            // è‚ºç™Œï¼ˆå«æ²¹çƒŸï¼‰
            const highKitchenExposure = 
                answers.kitchen_smoke === 'æ²¹çƒŸæ¯”è¾ƒå¤§' || answers.kitchen_smoke === 'æ²¹çƒŸå¾ˆé‡ï¼Œç»å¸¸å‘›äºº' ||
                (answers.cook_often === 'ç»å¸¸ä¼šåšï¼ˆæ¯å‘¨â‰¥2æ¬¡ï¼‰' && (answers.cook_years >= 10 || answers.cook_weekly >= 5));
            if (
                answers.smoking_status === 'ç°åœ¨è¿˜åœ¨å¸çƒŸ' ||
                (answers.gender === 'å¥³' && highKitchenExposure)
            ) {
                risks.push('è‚ºç™Œï¼šä¸­é«˜é£é™©ï¼ˆç‰¹åˆ«æé†’ï¼šå¨æˆ¿æ²¹çƒŸæ˜¯å¥³æ€§éå¸çƒŸè€…çš„é‡è¦é£é™©å› ç´ ï¼‰');
                recs.push('å»ºè®®ï¼š40å²ä»¥ä¸Šè€ƒè™‘åšä½å‰‚é‡èƒ¸éƒ¨CTç­›æŸ¥');
            }

            // ä¹³è…ºç™Œ
            if (answers.gender === 'å¥³') {
                let breastRisk = 0;
                if (answers.family_cancer.includes('ä¹³è…ºç™Œ')) breastRisk += 2;
                if (answers.menarche_age && answers.menarche_age < 12) breastRisk += 1;
                if (answers.menopause_age && answers.menopause_age > 55) breastRisk += 1;
                if (answers.first_birth_age && answers.first_birth_age > 35) breastRisk += 1;
                if (answers.breastfeed_months && answers.breastfeed_months < 12) breastRisk += 1;
                if (answers.hrt_use === 'ç”¨è¿‡' && answers.hrt_type === 'åªç”¨é›Œæ¿€ç´ ') breastRisk += 2;

                if (breastRisk >= 2) {
                    risks.push('ä¹³è…ºç™Œï¼šä¸­é«˜é£é™©');
                    recs.push('å»ºè®®ï¼š40å²èµ·æ¯å¹´åšä¹³è…ºè¶…å£°ï¼Œå¿…è¦æ—¶åŠ é’¼é¶ï¼›é«˜é£é™©è€…è€ƒè™‘MRI');
                }
            }

            // åµå·¢ç™Œ & å­å®«å†…è†œç™Œ
            if (answers.gender === 'å¥³') {
                if (
                    answers.family_cancer.includes('åµå·¢ç™Œ') ||
                    (answers.miscarriage_count >= 2 && answers.live_birth === 'æ²¡æœ‰ç”Ÿè¿‡')
                ) {
                    risks.push('åµå·¢ç™Œï¼šä¸­é£é™©');
                    recs.push('å»ºè®®ï¼šå®šæœŸå¦‡ç§‘Bè¶… + CA125è¡€æ¶²æ£€æŸ¥ï¼›æœ‰å®¶æ—å²è€…å»ºè®®åŸºå› æ£€æµ‹');
                }

                if (
                    answers.hrt_use === 'ç”¨è¿‡' && answers.hrt_type === 'åªç”¨é›Œæ¿€ç´ '
                ) {
                    risks.push('å­å®«å†…è†œç™Œï¼šé«˜é£é™©ï¼ˆå•ç”¨é›Œæ¿€ç´ æ›¿ä»£æ²»ç–—ï¼‰');
                    recs.push('å»ºè®®ï¼šæ¯å¹´åšå¦‡ç§‘Bè¶…ç›‘æµ‹å­å®«å†…è†œåšåº¦');
                }
            }

            // èƒƒç™Œ
            if (
                answers.infection.includes('å¹½é—¨èºæ†èŒï¼ˆä¸€ç§èƒƒéƒ¨ç»†èŒï¼‰') ||
                answers.diet.some(d => d.includes('è…Œåˆ¶') || d.includes('ç†åˆ¶')) ||
                answers.family_cancer.includes('èƒƒç™Œ') ||
                (answers.residence === 'å†œæ‘' && answers.diet.some(d => d.includes('è…Œåˆ¶')))
            ) {
                risks.push('èƒƒç™Œï¼šä¸­é«˜é£é™©');
                recs.push('å»ºè®®ï¼š40å²ä»¥ä¸Šåšä¸€æ¬¡èƒƒé•œæ£€æŸ¥ï¼Œå¹½é—¨èºæ†èŒé˜³æ€§è€…éœ€æ ¹é™¤æ²»ç–—');
            }

            // è‚ç™Œ
            if (answers.infection.includes('ä¹™è‚ç—…æ¯’ï¼ˆHBVï¼‰') || answers.infection.includes('ä¸™è‚ç—…æ¯’ï¼ˆHCVï¼‰')) {
                risks.push('è‚ç™Œï¼šé«˜é£é™©');
                recs.push('å»ºè®®ï¼šæ¯6ä¸ªæœˆæŸ¥ä¸€æ¬¡ç”²èƒè›‹ç™½ï¼ˆAFPï¼‰+ è‚è„Bè¶…');
            }

            if (risks.length === 0) {
                risks.unshift('æ€»ä½“ï¼šä¸€èˆ¬é£é™©äººç¾¤');
                recs.push('å»ºè®®ï¼šä¿æŒå¥åº·ç”Ÿæ´»æ–¹å¼ï¼ŒæŒ‰å¸¸è§„ä½“æ£€é¡¹ç›®ç­›æŸ¥å³å¯');
            } else {
                risks.unshift('æ€»ä½“ï¼šå±äºç™Œç—‡ä¸­é«˜é£é™©äººç¾¤');
            }

            reportHTML += `<h3>ğŸ” é£é™©è¯„ä¼°ç»“æœ</h3><ul>${risks.map(r => `<li>${r}</li>`).join('')}</ul>`;
            reportHTML += `<h3>âœ… ä¸ªæ€§åŒ–ç­›æŸ¥å»ºè®®</h3><ul>${recs.map(r => `<li>${r}</li>`).join('')}</ul>`;
            reportHTML += `<p style="background:#fff8e1; padding:12px; border-radius:6px; margin-top:15px;">
                <strong>ğŸ“Œ é‡è¦æé†’ï¼š</strong>æœ¬æŠ¥å‘Šä¾æ®ã€Šå¥åº·ä½“æ£€æœºæ„é˜²ç™Œä½“æ£€æŒ‡å—2025ç‰ˆã€‹ç”Ÿæˆï¼Œ<strong>ä»…ä¾›å‚è€ƒ</strong>ï¼Œä¸èƒ½æ›¿ä»£åŒ»ç”Ÿé¢å¯¹é¢è¯Šç–—ã€‚å¦‚æœ‰ç–‘é—®ï¼Œè¯·å’¨è¯¢ä¸“ä¸šåŒ»ç–—æœºæ„ã€‚
            </p>`;
            reportHTML += `
                <div class="btn-group">
                    <button id="exportBtn" onclick="exportToPDF()">ğŸ“„ ä¿å­˜ä¸ºPDF</button>
                    <button id="resetBtn" onclick="resetAssessment()">ğŸ”„ å†æµ‹ä¸€æ¬¡</button>
                </div>
            </div>`;

            document.getElementById('reportArea').innerHTML = reportHTML;
            document.getElementById('reportArea').classList.remove('hidden');
        }

        // å¯åŠ¨
        renderQuestion();
    </script>
</body>
</html>